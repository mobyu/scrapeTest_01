##### 代理池维护

1. 代理池分为四个基本模块  

   + 储存模块：储存爬取下来的代理  
   + 获取模块：定时在各大代理网站爬取代理
   + 检测模块：定时检测储存模块中的代理是否可用
   + 接口模块：勇API提供对外服务的接口

2. 存储模块  
   使用Redis的有序集合，集合中每个元素即使代理，例如：60.207.237.111:8888  
   有序集合中每个元素都有一个分数字段，根据元素分数大小进行排序，实现有序。
   分数设置方案：
   ```tex
   新获取的代理的设置分数为10；一经验证可用设置为100；如果检测到代理不可用，将分数减1，减到0，删除该代理
   原因：
   	1.免费代理网站获取代理不稳定，存在一定失败率，如果可用设为100，确保代理有机会被调用；
   	2.连续失败100次才将代理删除，是因为可用代理十分宝贵；
   	3.新获取的代理连续失败10次即删除，减小开销。
   ```  
   语法解释：
   ```python
   def random(self) -> Proxy:
       pass
   # -> 主要是标记返回值数据类型,这样只看代码就知道该方法返回什么类型数据。
    ```  
   + \_\_init__方法用于初始化，参数是Redis的链接信息，默认链接信息定义为常量；
   + add方法添加代理并设置分数；
   + random方法用户随机获取代理，首先获取分数为100的代理，然后从中随机返回一个；如果不存在100分，按照排名，获取前100位代理，然后随机返回一个；否则抛出异常；
   + decrease检测到无效代理，减1分；
   + exists判断代理是否存在于合集中；
   + max 将代理的分数设为PROXY_SCORE_MAX（100）
   + count 返回集合中元素个数（未失效代理个数）
   + all 返回集合中所有元素的列表。
   
3. 获取模块  
   在父类中实现通用爬取的fetch方法，然后在每个子类里实现解析方法  
4. 检测模块  
   使用aiohttp库进行异步检测  
5. 接口模块  
   考虑因素：
   + redis信息安全；  
   + 远程redis服务器如果只允许本地连接；
   + 爬虫所在主机没有连接redis模块；或这爬虫不是由python编写；
   + RedisClient或者数据结构更新，爬虫端必须同步  
   综上：将代理池作为独立服务运行，增加接口模块，使用Flask库来实现。